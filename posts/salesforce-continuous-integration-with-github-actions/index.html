<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Salesforce Continuous Integration with GitHub Actions</title>
<meta name=description content><meta name=image content="https://shunkosa.github.io/posts/img/20190825_3.png"><meta itemprop=name content="Salesforce Continuous Integration with GitHub Actions"><meta itemprop=description content><meta itemprop=image content="https://shunkosa.github.io/posts/img/20190825_3.png"><meta name=og:title content="Salesforce Continuous Integration with GitHub Actions"><meta name=og:description content><meta name=og:image content="https://shunkosa.github.io/posts/img/20190825_3.png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta name=og:url content="https://shunkosa.github.io/posts/salesforce-continuous-integration-with-github-actions/"><meta name=og:site_name content="Salesforce Continuous Integration with GitHub Actions"><meta name=og:type content="article"><meta name=twitter:card content="summary"><meta name=twitter:url content="https://shunkosa.github.io/posts/salesforce-continuous-integration-with-github-actions/"><meta name=twitter:site content="@shunkosa"><meta name=twitter:creator content="@shunkosa"><meta name=article:tag content><link rel=stylesheet type=text/css href=https://shunkosa.github.io/css/style.css></head><body><header><div class=global-header><div class=gravatar><img class=homepage-avatar src="https://www.gravatar.com/avatar/092c1bb36d22dc33c1dacf9b5838deb5?s=256&d=identicon"></div><div class=site-title><a href=https://shunkosa.github.io/><h1>Shun Kosaka</h1></a><p><i>Things and thoughts about Salesforce and technology</i></p></div><div class=site-navigation>&nbsp;&nbsp;<a href=https://shunkosa.github.io/about/>About</a>&nbsp;&nbsp;<a href=https://shunkosa.github.io/archives/>Archives</a>&nbsp;&nbsp;<a href=https://shunkosa.github.io/library/>Library</a></div></div></header><div class=content><h1>Salesforce Continuous Integration with GitHub Actions</h1><aside></aside><p><p>After 6 months in the wait list, <a href=https://github.com/features/actions>GitHub Actions</a> (v2) finally came to my account. It&rsquo;s a built-in CI/CD service for GitHub. I quickly tested it and I found it pretty good tool for GitHub users to start CI easily.</p><p><img src=../img/20190825_1.png alt></p><p>In this post, I&rsquo;ll show a simple example to realize continuous integration for Salesforce development. When a pull request is created, the following tasks will be automatically executed.</p><ul><li>Create a scratch org</li><li>Push source</li><li>Run Apex tests</li><li>Comment the org login url to the thread. (NOTICE: Don&rsquo;t do this in public repos)</li></ul><h2 id=initial-setup>Initial setup</h2><p>Create a connected app and a private key for JWT flow. Follow the steps in the <a href=https://trailhead.salesforce.com/en/content/learn/modules/sfdx_travis_ci/sfdx_travis_ci_connected_app>Trailhead project</a>.</p><h2 id=save-secrets>Save secrets</h2><p>Store the consumer key of connected app as <code>SALESFORCE_CONSUMER_KEY</code> to repository secret. I also store secret key directly as <code>SALESFORCE_JWT_SECRET_KEY</code>. Or, you can store the decryption key and IV for encrypted secret key in the repository. And store the username of DevHub as <code>SALESFORCE_DEVHUB_USERNAME</code>.</p><p><img src=../img/20190825_2.png alt></p><h2 id=define-workflow>Define workflow</h2><p>Define workflow in <code>.github/workflows/main.yaml</code>. For more information about workflow syntax, see <a href=https://help.github.com/en/articles/workflow-syntax-for-github-actions>Workflow Syntax for GitHub Actions</a>
<script type=application/javascript src=https://gist.github.com/shunkosa/905d131a96d9c8619ae039529c040b20.js></script></p><h3 id=highlights>Highlights</h3><ul><li>A workflow is made up of one ore more jobs. A job contains a sequence of tasks called steps. Jobs run in parallel by default and each job runs in a fresh instance. In the above workflow, for simplicity, single job named <code>build</code> runs.</li><li>(line 9) : <code>checkout@master</code> runs <code>git fetch</code> and <code>git checkout $GITHUB_SHA</code>, so this action always checkouts the commit of the event trigger.</li><li>(line 24) : The repository secrets are available in workflow by <code>${{ secrets.YOUR_SECRET_NAME }}</code>.</li><li>(line 39) : GitHub API is used to comment to the pull request. You can use default <code>GITHUB_TOKEN</code> secret as access token. You don&rsquo;t have to generate a new token for CI/CD service!</li><li>(line 40) : <code>github</code> default context is used to specify the pull request URL. For more information, see <a href=https://help.github.com/en/articles/events-that-trigger-workflows>Events that trigger workflows</a>.</li></ul><h2 id=see-how-it-works>See how it works</h2><p><img src=../img/20190825_3.png alt></p><p>Now you can easily and effectively review the pull request using the scratch org automatically created and tested.</p><p>Next step is to delete the scratch org after the pull request is merged/closed. We need to store the org username somehow.</p><p>I like GitHub Actions from many views. Tightly-coupled with the repository (infinite possibilities to integrate with the repository!). Concurrency. Supporting multiple OS. Various 3rd party actions.</p><p>I hope more and more Salesforce developers try GitHub Actions. Share if you create an awesome action!</p></p></div><p class=date>Written on Aug 24, 2019.</p><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//shunkosa.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><footer><p>&copy; 2024 All rights reserved.</p></footer></body></html>